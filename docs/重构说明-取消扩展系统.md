# PocketBase æ‰©å±•ç³»ç»Ÿé‡æ„è¯´æ˜

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å°† PocketBase åŠŸèƒ½ä»æ‰©å±•ç³»ç»Ÿè¿ç§»åˆ°æ ¸å¿ƒæ¶æ„ï¼Œé‡‡ç”¨æ›´ç›´æ¥ã€æ¸…æ™°çš„åˆ†å±‚è®¾è®¡ã€‚

## ğŸ¯ é‡æ„ç›®æ ‡

1. **ç®€åŒ–æ¶æ„**ï¼šå–æ¶ˆä¸å¿…è¦çš„æ‰©å±•ç³»ç»ŸæŠ½è±¡å±‚
2. **èŒè´£æ¸…æ™°**ï¼šæŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†ä»£ç 
3. **æ˜“äºç»´æŠ¤**ï¼šé‡‡ç”¨æ‰å¹³åŒ–çš„ç›®å½•ç»“æ„
4. **ç¬¦åˆæœ€ä½³å®è·µ**ï¼šéµå¾ª Vue3 Composables æ¨¡å¼

## ğŸ“ æ–°æ¶æ„è®¾è®¡

### ç›®å½•ç»“æ„å¯¹æ¯”

**é‡æ„å‰ï¼š**

```
src/
â””â”€â”€ extensions/
    â””â”€â”€ pocketbase/
        â”œâ”€â”€ index.ts                 # æ‰©å±•å¯¼å‡º
        â”œâ”€â”€ realtime.ts              # Realtime ç®¡ç†å™¨
        â”œâ”€â”€ README.md                # æ–‡æ¡£
        â”œâ”€â”€ hooks/
        â”‚   â”œâ”€â”€ useAuth.ts          # è®¤è¯ Hook
        â”‚   â”œâ”€â”€ useSync.ts          # åŒæ­¥ Hook
        â”‚   â””â”€â”€ useRealtime.ts      # Realtime Hook
        â”œâ”€â”€ api/
        â”‚   â””â”€â”€ client.ts           # API å®¢æˆ·ç«¯ï¼ˆæ‰€æœ‰ API æ··åœ¨ä¸€èµ·ï¼‰
        â””â”€â”€ types/
            â””â”€â”€ index.ts            # ç±»å‹å®šä¹‰
```

**é‡æ„åï¼š**

```
src/
â”œâ”€â”€ services/                       # æœåŠ¡å±‚ï¼ˆä¸åç«¯ API äº¤äº’ï¼‰
â”‚   â””â”€â”€ pocketbase/
â”‚       â”œâ”€â”€ client.ts              # PocketBase å®¢æˆ·ç«¯å®ä¾‹
â”‚       â”œâ”€â”€ auth.ts                # è®¤è¯æœåŠ¡ API
â”‚       â”œâ”€â”€ notes.ts               # ç¬”è®°æœåŠ¡ API
â”‚       â”œâ”€â”€ users.ts               # ç”¨æˆ·æœåŠ¡ API
â”‚       â”œâ”€â”€ files.ts               # æ–‡ä»¶æœåŠ¡ API
â”‚       â””â”€â”€ index.ts               # ç»Ÿä¸€å¯¼å‡º
â”‚
â”œâ”€â”€ hooks/                         # Vue Composablesï¼ˆå¯ç»„åˆå‡½æ•°ï¼Œå“åº”å¼çŠ¶æ€ç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ useAuth.ts                 # è®¤è¯ Hook
â”‚   â”œâ”€â”€ useSync.ts                 # åŒæ­¥ Hook
â”‚   â”œâ”€â”€ useRealtime.ts             # Realtime Hook
â”‚   â”œâ”€â”€ useEditor.ts               # ç¼–è¾‘å™¨ Hook
â”‚   â”œâ”€â”€ useTheme.ts                # ä¸»é¢˜ Hook
â”‚   â””â”€â”€ ...                        # å…¶ä»– Hooks
â”‚
â”œâ”€â”€ core/                          # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œç®¡ç†å™¨
â”‚   â””â”€â”€ realtime.ts                # Realtime è¿æ¥ç®¡ç†å™¨
â”‚
â””â”€â”€ types/                         # TypeScript ç±»å‹å®šä¹‰
    â””â”€â”€ pocketbase.ts              # PocketBase ç›¸å…³ç±»å‹
```

## ğŸ”„ é‡æ„å†…å®¹è¯¦è§£

### 1. æœåŠ¡å±‚æ‹†åˆ† (services/pocketbase/)

å°†åŸæ¥æ··åœ¨ä¸€èµ·çš„ `api/client.ts` æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡æ¨¡å—ï¼š

- **client.ts**: PocketBase å®¢æˆ·ç«¯å®ä¾‹å’Œé”™è¯¯æ˜ å°„å·¥å…·
- **auth.ts**: è®¤è¯ç›¸å…³ APIï¼ˆç™»å½•ã€æ³¨å†Œã€ç™»å‡ºç­‰ï¼‰
- **notes.ts**: ç¬”è®°ç›¸å…³ APIï¼ˆå¢åˆ æ”¹æŸ¥ã€åŒæ­¥ï¼‰
- **users.ts**: ç”¨æˆ·æŸ¥è¯¢ API
- **files.ts**: æ–‡ä»¶ç®¡ç† API
- **index.ts**: ç»Ÿä¸€å¯¼å‡ºï¼Œæä¾›å‘åå…¼å®¹çš„åˆ«å

**ä¼˜åŠ¿ï¼š**

- âœ… èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- âœ… æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼Œä¾¿äºæŸ¥æ‰¾
- âœ… æ”¯æŒæŒ‰éœ€å¯¼å…¥ï¼Œå‡å°‘æ‰“åŒ…ä½“ç§¯

### 2. Hooks è¿ç§» (hooks/)

å°†æ‰©å±•ç³»ç»Ÿä¸­çš„ hooks è¿ç§»åˆ°æ ¸å¿ƒ hooks ç›®å½•ï¼š

- `useAuth.ts`: è®¤è¯ Hookï¼Œæä¾›å“åº”å¼çš„è®¤è¯çŠ¶æ€å’Œæ–¹æ³•
- `useSync.ts`: åŒæ­¥ Hookï¼Œæä¾›ç¬”è®°ä¸äº‘ç«¯çš„åŒå‘åŒæ­¥
- `useRealtime.ts`: Realtime Hookï¼Œæä¾›å®æ—¶è¿æ¥ç®¡ç†

**ä¼˜åŠ¿ï¼š**

- âœ… ä¸å…¶ä»– hooks ç»Ÿä¸€ç®¡ç†
- âœ… ç¬¦åˆ Vue3 Composables æœ€ä½³å®è·µ
- âœ… æ›´æ˜“äºè¢«å…¶ä»–ç»„ä»¶å‘ç°å’Œä½¿ç”¨

### 3. Realtime ç®¡ç†å™¨è¿ç§» (core/)

å°† `realtime.ts` ä»æ‰©å±•ç›®å½•è¿ç§»åˆ°æ ¸å¿ƒç›®å½•ï¼š

- ä½œä¸ºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†
- è´Ÿè´£ PocketBase å®æ—¶è¿æ¥ç®¡ç†
- å¤„ç†è‡ªåŠ¨é‡è¿å’Œæ¶ˆæ¯åˆ†å‘

**ä¼˜åŠ¿ï¼š**

- âœ… ä¸å…¶ä»–æ ¸å¿ƒåŠŸèƒ½ç»Ÿä¸€ç®¡ç†
- âœ… æ˜ç¡®å…¶ä½œä¸ºæ ¸å¿ƒåŠŸèƒ½çš„åœ°ä½

### 4. ç±»å‹å®šä¹‰ç»Ÿä¸€ (types/)

åˆ›å»º `types/pocketbase.ts` ç»Ÿä¸€ç®¡ç† PocketBase ç›¸å…³ç±»å‹ï¼š

- `PublicUserInfo`: å…¬å¼€ç”¨æˆ·ä¿¡æ¯
- `AuthResponse`: è®¤è¯å“åº”æ¥å£
- `RealtimeStatus`: Realtime è¿æ¥çŠ¶æ€
- `RealtimeEvent`: Realtime äº‹ä»¶ç±»å‹
- `RealtimeConfig`: Realtime é…ç½®

**ä¼˜åŠ¿ï¼š**

- âœ… ç±»å‹å®šä¹‰é›†ä¸­ç®¡ç†
- âœ… ä¾¿äºç±»å‹å¤ç”¨å’Œç»´æŠ¤
- âœ… æä¾›æ›´å¥½çš„ TypeScript æ”¯æŒ

### 5. å¯¼å…¥è·¯å¾„æ›´æ–°

æ‰€æœ‰å¼•ç”¨æ—§è·¯å¾„çš„æ–‡ä»¶å·²æ›´æ–°ï¼š

**æ—§è·¯å¾„ â†’ æ–°è·¯å¾„ï¼š**

- `@/extensions/pocketbase/api/client` â†’ `@/services/pocketbase`
- `@/extensions/pocketbase/hooks/useAuth` â†’ `@/hooks/useAuth`
- `@/extensions/pocketbase/hooks/useSync` â†’ `@/hooks/useSync`
- `@/extensions/pocketbase/hooks/useRealtime` â†’ `@/hooks/useRealtime`
- `@/extensions/pocketbase/types` â†’ `@/types/pocketbase`

**å—å½±å“çš„æ–‡ä»¶ï¼š**

- `src/components/UserProfile.vue`
- `src/views/RegisterPage.vue`
- `src/views/LoginPage.vue`
- `src/views/UserPublicNotesPage.vue`
- `src/composables/useEditor.ts`
- `src/hooks/useUserPublicNotesSync.ts`
- `src/hooks/useUserCache.ts`
- `src/adapters/pocketbase/auth-adapter.ts`
- `src/adapters/pocketbase/realtime-adapter.ts`

### 6. æ‰©å±•ç³»ç»Ÿæ›´æ–°

ç”±äº PocketBase åŠŸèƒ½å·²è¿ç§»åˆ°æ ¸å¿ƒå±‚ï¼Œ`useExtensions.ts` å·²æ›´æ–°ï¼š

- ç§»é™¤ pocketbase æ‰©å±•çš„å…ƒæ•°æ®
- ç¦ç”¨åŠ¨æ€å¯¼å…¥ pocketbase æ‰©å±•çš„é€»è¾‘
- æ·»åŠ åºŸå¼ƒæç¤ºä¿¡æ¯

## ğŸ é‡æ„ä¼˜åŠ¿

### 1. æ¶æ„æ›´æ¸…æ™°

- âœ… å»é™¤æ‰©å±•ç³»ç»Ÿçš„å¤æ‚æŠ½è±¡
- âœ… æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ä»£ç 
- âœ… åˆ†å±‚æ¸…æ™°ï¼šæœåŠ¡å±‚ â†’ Hooks â†’ ç»„ä»¶

### 2. æ˜“äºç»´æŠ¤

- âœ… æ–‡ä»¶ç»“æ„æ‰å¹³ï¼Œä¾¿äºæŸ¥æ‰¾
- âœ… èŒè´£å•ä¸€ï¼Œä¿®æ”¹å½±å“èŒƒå›´å°
- âœ… API æŒ‰åŠŸèƒ½æ‹†åˆ†ï¼Œæ˜“äºç†è§£

### 3. æ›´å¥½çš„å¼€å‘ä½“éªŒ

- âœ… å¯¼å…¥è·¯å¾„æ›´ç›´è§‚
- âœ… ç¬¦åˆ Vue3 æœ€ä½³å®è·µ
- âœ… TypeScript ç±»å‹æ”¯æŒæ›´å¥½

### 4. æ€§èƒ½ä¼˜åŒ–

- âœ… æ”¯æŒæŒ‰éœ€å¯¼å…¥
- âœ… å‡å°‘ä¸å¿…è¦çš„æŠ½è±¡å±‚
- âœ… æ‰“åŒ…ä½“ç§¯æ›´å°

## ğŸ“ è¿ç§»æ£€æŸ¥æ¸…å•

- [x] åˆ›å»º services/pocketbase ç›®å½•å¹¶æ‹†åˆ† API
- [x] è¿ç§» hooks åˆ° hooks/ ç›®å½•
- [x] è¿ç§» realtime.ts åˆ° core/ ç›®å½•
- [x] åˆ›å»º types/pocketbase.ts ç»Ÿä¸€ç±»å‹å®šä¹‰
- [x] æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
- [x] æ›´æ–° useExtensions.ts
- [x] åˆ é™¤ extensions/pocketbase ç›®å½•
- [x] éªŒè¯æ—  lint é”™è¯¯
- [x] åˆ›å»ºè¿ç§»è¯´æ˜æ–‡æ¡£

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### è®¤è¯æœåŠ¡

```typescript
// æ—§æ–¹å¼
import { authApi } from '@/extensions/pocketbase/api/client'

// æ–°æ–¹å¼
import { authService } from '@/services/pocketbase'

// ä½¿ç”¨
const result = await authService.signIn(email, password)
```

### è®¤è¯ Hook

```typescript
// æ—§æ–¹å¼
import { useAuth } from '@/extensions/pocketbase/hooks/useAuth'

// æ–°æ–¹å¼
import { useAuth } from '@/hooks/useAuth'

// ä½¿ç”¨
const { login, logout, isLoggedIn, userInfo } = useAuth()
```

### åŒæ­¥ Hook

```typescript
// æ—§æ–¹å¼
import { useSync } from '@/extensions/pocketbase/hooks/useSync'

// æ–°æ–¹å¼
import { useSync } from '@/hooks/useSync'

// ä½¿ç”¨
const { sync, syncing, syncStatus } = useSync()
```

### Realtime ç®¡ç†å™¨

```typescript
// æ–°æ–¹å¼
import { getRealtimeInstance } from '@/core/realtime'

// æ—§æ–¹å¼
import { getRealtimeInstance } from '@/extensions/pocketbase/realtime'

// ä½¿ç”¨
const realtime = getRealtimeInstance()
await realtime.connect()
```

### ç±»å‹å®šä¹‰

```typescript
// æ—§æ–¹å¼
import type { PublicUserInfo } from '@/extensions/pocketbase/types'

// æ–°æ–¹å¼
import type { PublicUserInfo } from '@/types/pocketbase'
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**ï¼š`services/pocketbase/index.ts` ä¸­æä¾›äº†æ—§ API åç§°çš„åˆ«åï¼ˆå¦‚ `authApi`ï¼‰ï¼Œä»¥ä¿æŒå‘åå…¼å®¹

2. **æ‰©å±•ç³»ç»Ÿ**ï¼š`useExtensions` ä»ç„¶ä¿ç•™ï¼Œä½† pocketbase æ‰©å±•å·²ç§»é™¤ã€‚å¦‚æœä¸å†éœ€è¦æ‰©å±•ç³»ç»Ÿï¼Œå¯ä»¥è€ƒè™‘å®Œå…¨ç§»é™¤ç›¸å…³ä»£ç 

3. **é€‚é…å™¨**ï¼š`src/adapters/pocketbase/` ç›®å½•ä¿ç•™ï¼Œå› ä¸ºå®ƒä»¬å®ç°äº†æ ¸å¿ƒæ¥å£ï¼Œæ˜¯é€‚é…å™¨æ¨¡å¼çš„ä¸€éƒ¨åˆ†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¶æ„è¯´æ˜](./æ¶æ„è¯´æ˜.md)
- [å¼€å‘æ–‡æ¡£](./å¼€å‘æ–‡æ¡£/)
- [äº§å“æ–‡æ¡£](./äº§å“æ–‡æ¡£/)

## âœ… é‡æ„å®Œæˆ

æ‰€æœ‰é‡æ„ä»»åŠ¡å·²å®Œæˆï¼Œä»£ç å·²é€šè¿‡ lint æ£€æŸ¥ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚

---

**é‡æ„æ—¥æœŸ**: 2025-10-24
**é‡æ„äººå‘˜**: AI Assistant
